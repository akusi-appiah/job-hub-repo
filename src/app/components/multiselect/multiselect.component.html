<div class="relative w-full">
  <button
    type="button"
    [disabled]="disabled()"
    (click)="toggleDropdown($event)"
    class="w-full bg-white border text-gray-700 border-gray-300 rounded-md px-3 py-2 text-left flex justify-between items-center"
  >
    {{ selectedText() }}
    <span class="ml-auto">â–¼</span>
  </button>

  @if (isOpen()) {
    <div
    class="absolute mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto z-10 w-full max-w-full">
      @if (searchable()) {
        <div class="p-2">
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange()"
            placeholder="Search..."
            class="w-full border border-gray-300 rounded-md px-2 py-1"
          />
        </div>
      }

      @if (filteredOptions().length === 0) {
        <div class="p-2 text-gray-500">No options found</div>
      }
      @for (option of filteredOptions(); track option.categoryId) {
        <div class="flex items-center px-3 py-2 cursor-pointer hover:bg-blue-50 transition-colors duration-150">
          <input
            type="checkbox"
            [id]="'option-' + option.categoryId"
            [checked]="isSelected(option.categoryId)"
            (change)="toggleOption(option, $event)"
            class="mr-2 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 focus:ring-2" 
          />
          <label [for]="'option-' + option.categoryId" class="flex-grow text-sm font-medium text-gray-700 cursor-pointer">
            {{ option.name }}
          </label>
          @if (option.description) {
            <span class="text-sm text-gray-600  ml-auto px-2 py-1  font-medium  bg-gray-100 rounded-full ">
              {{ option.description }}
            </span>
          }
        </div>
      }

      @if (selectedValues().length > 0) {
        <div class="mt-2 flex justify-between text-sm text-gray-500 px-3 py-2 border-t">
          {{ selectedValues().length }} of {{ options().length }} selected
          <button (click)="clearAll()" class="text-blue-500 hover:underline">Clear All</button>
        </div>
      }
    </div>
  }
</div>